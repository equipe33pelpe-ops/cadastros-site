<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Cadastro</title>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
  <h1>Cadastro de Acesso</h1>

  <form id="form">
    <label>Nome</label><br>
    <input name="nome" required><br><br>

    <label>CPF</label><br>
    <input name="cpf" required><br><br>

    <label>Telefone</label><br>
    <input name="telefone"><br><br>

    <label>E-mail</label><br>
    <input name="email" type="email"><br><br>

    <div class="cf-turnstile" data-sitekey="COLE_AQUI_SUA_SITE_KEY"></div>
    <br>

    <button type="submit">Enviar</button>
  </form>

  <pre id="saida"></pre>

  <script>
    const API_BASE = "COLE_AQUI_A_URL_DO_SEU_WORKER"; // ex: https://api-cadastros.seuuser.workers.dev

    document.getElementById("form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const turnstileToken = document.querySelector('input[name="cf-turnstile-response"]')?.value;
      const fd = new FormData(e.target);

      const payload = {
        nome: fd.get("nome"),
        cpf: fd.get("cpf"),
        telefone: fd.get("telefone"),
        email: fd.get("email"),
        turnstileToken
      };

      const r = await fetch(`${API_BASE}/api/cadastro`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await r.json();
      const saida = document.getElementById("saida");

      if (!r.ok) {
        saida.textContent = "Erro: " + (data.error || "desconhecido");
        return;
      }

      saida.textContent =
        `âœ… Cadastro enviado!\n\nSeu protocolo Ã©: ${data.protocolo}\n\n` +
        `ðŸ“Ž Envie seus documentos pelo WhatsApp/E-mail e informe esse protocolo na mensagem.`;
      e.target.reset();
    });
  </script>
</body>
</html>
